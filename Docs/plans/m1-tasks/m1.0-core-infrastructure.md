---
title: "M1.0 프로젝트 구조 및 핵심 인프라"
type: feat
date: 2026-01-26
milestone: M1
task_id: M1.0
depends_on: []
scripts: 5
---

# M1.0: 프로젝트 구조 및 핵심 인프라

## 목표

Unity 프로젝트의 폴더 구조를 생성하고, 모든 시스템이 사용할 핵심 인프라를 구축합니다.

## 작업 내용

### 1. 폴더 구조 생성

```
Assets/02.Scripts/
├── Core/
├── Interfaces/
├── Services/
├── Tree/
├── Player/
├── Economy/
├── Lumberjack/
├── UI/
├── Effects/
└── Utils/
```

### 2. ServiceLocator.cs

**파일:** `Assets/02.Scripts/Core/ServiceLocator.cs`

```csharp
using System;
using System.Collections.Generic;

/// <summary>
/// 간단한 ServiceLocator 패턴 구현
/// M2+에서 DI 컨테이너로 교체 가능
/// </summary>
public static class ServiceLocator
{
    private static readonly Dictionary<Type, object> services = new();

    public static void Register<T>(T service) where T : class
    {
        services[typeof(T)] = service;
    }

    public static T Get<T>() where T : class
    {
        if (services.TryGetValue(typeof(T), out var service))
        {
            return service as T;
        }
        throw new InvalidOperationException($"Service {typeof(T).Name} not registered");
    }

    public static bool TryGet<T>(out T service) where T : class
    {
        if (services.TryGetValue(typeof(T), out var obj))
        {
            service = obj as T;
            return true;
        }
        service = null;
        return false;
    }

    public static void Clear()
    {
        services.Clear();
    }
}
```

### 3. GameEvents.cs

**파일:** `Assets/02.Scripts/Core/GameEvents.cs`

```csharp
using System;
using UnityEngine;

/// <summary>
/// 중앙화된 게임 이벤트 시스템
/// 인스턴스 기반으로 메모리 누수 방지
/// </summary>
public class GameEvents : MonoBehaviour
{
    public static GameEvents Instance { get; private set; }

    // 재화 이벤트
    public event Action<long> OnWoodChanged;
    public event Action<long> OnWoodAdded;

    // 클릭 이벤트
    public event Action<Vector3> OnClickPerformed;
    public event Action<GameObject> OnTreeClicked;
    public event Action OnTreeHit;

    // 업그레이드 이벤트
    public event Action<string, int> OnUpgradePurchased;

    private void Awake()
    {
        if (Instance != null && Instance != this)
        {
            Destroy(gameObject);
            return;
        }
        Instance = this;
    }

    // 이벤트 발행 메서드
    public void RaiseWoodChanged(long amount) => OnWoodChanged?.Invoke(amount);
    public void RaiseWoodAdded(long amount) => OnWoodAdded?.Invoke(amount);
    public void RaiseClickPerformed(Vector3 pos) => OnClickPerformed?.Invoke(pos);
    public void RaiseTreeClicked(GameObject tree) => OnTreeClicked?.Invoke(tree);
    public void RaiseTreeHit() => OnTreeHit?.Invoke();
    public void RaiseUpgradePurchased(string id, int level) => OnUpgradePurchased?.Invoke(id, level);
}
```

### 4. ISaveable.cs

**파일:** `Assets/02.Scripts/Interfaces/ISaveable.cs`

```csharp
/// <summary>
/// M2 저장 시스템을 위한 인터페이스
/// M1에서는 정의만 하고, M2에서 구현
/// </summary>
public interface ISaveable
{
    string SaveKey { get; }
    object CaptureState();
    void RestoreState(object state);
}
```

### 5. IClickable.cs

**파일:** `Assets/02.Scripts/Interfaces/IClickable.cs`

```csharp
using UnityEngine;

/// <summary>
/// 클릭 가능한 오브젝트 인터페이스
/// </summary>
public interface IClickable
{
    void OnClick(Vector3 hitPoint);
}
```

### 6. ObjectPool.cs

**파일:** `Assets/02.Scripts/Utils/ObjectPool.cs`

```csharp
using System.Collections.Generic;
using UnityEngine;

/// <summary>
/// 범용 오브젝트 풀링 시스템
/// M2+에서 파티클, 벌목꾼 등에도 활용
/// </summary>
public class ObjectPool<T> where T : Component
{
    private readonly T prefab;
    private readonly Transform parent;
    private readonly Queue<T> pool = new();
    private readonly List<T> activeObjects = new();

    public ObjectPool(T prefab, Transform parent, int initialSize = 10)
    {
        this.prefab = prefab;
        this.parent = parent;

        for (int i = 0; i < initialSize; i++)
        {
            CreateNew();
        }
    }

    private T CreateNew()
    {
        T obj = Object.Instantiate(prefab, parent);
        obj.gameObject.SetActive(false);
        pool.Enqueue(obj);
        return obj;
    }

    public T Get()
    {
        T obj = pool.Count > 0 ? pool.Dequeue() : CreateNew();
        obj.gameObject.SetActive(true);
        activeObjects.Add(obj);
        return obj;
    }

    public void Return(T obj)
    {
        obj.gameObject.SetActive(false);
        activeObjects.Remove(obj);
        pool.Enqueue(obj);
    }

    public void ReturnAll()
    {
        foreach (var obj in activeObjects.ToArray())
        {
            Return(obj);
        }
    }
}
```

## 씬 설정

### GameScene.unity 기본 구성

1. **Hierarchy 구조:**
   ```
   GameScene
   ├── --- MANAGERS ---
   │   ├── GameEvents (GameEvents.cs)
   │   └── GameManager (M1.1에서 추가)
   ├── --- ENVIRONMENT ---
   │   ├── Main Camera
   │   ├── Directional Light
   │   └── Ground
   └── --- UI ---
       └── Canvas
   ```

2. **카메라 설정:**
   - Projection: Perspective
   - Field of View: 60
   - Position: (0, 5, -10)
   - Rotation: (30, 0, 0)

## Acceptance Criteria

- [x] 모든 폴더 구조 생성 완료
- [x] ServiceLocator.cs 컴파일 성공
- [ ] GameEvents.cs 컴파일 성공 + 씬에 배치
- [x] ISaveable.cs 컴파일 성공
- [x] IClickable.cs 컴파일 성공
- [x] ObjectPool.cs 컴파일 성공
- [ ] GameScene.unity 기본 구성 완료

## Unity Editor 작업 (수동)

아래 작업은 Unity Editor에서 수동으로 완료해야 합니다:

1. **GameScene 생성:**
   - Assets/01.Scenes/GameScene.unity 생성
   - 또는 기존 SampleScene을 복사하여 사용

2. **GameEvents 오브젝트 생성:**
   - Empty GameObject "GameEvents" 생성
   - GameEvents.cs 컴포넌트 추가
   - --- MANAGERS --- 하위에 배치

3. **카메라 설정:**
   - Position: (0, 5, -10)
   - Rotation: (30, 0, 0)
   - Field of View: 60

## 다음 태스크

→ M1.1 입력 및 재화 시스템

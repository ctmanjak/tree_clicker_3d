---
title: "M1.4 게임 필 - 플로팅 텍스트/파티클"
type: feat
date: 2026-01-26
milestone: M1
task_id: M1.4
depends_on: [M1.2]
scripts: 4
---

# M1.4: 게임 필 - 플로팅 텍스트/파티클

## 목표

클릭 시 획득량 표시 플로팅 텍스트와 나무 조각/잎사귀 파티클을 구현합니다.

## 의존성

- **M1.0**: ObjectPool 유틸리티
- **M1.2**: GameEvents.OnTreeHit, GameEvents.OnWoodAdded

## 작업 내용

### 1. FloatingText.cs

**파일:** `Assets/02.Scripts/Effects/FloatingText.cs`

```csharp
using System.Collections;
using UnityEngine;
using TMPro;

/// <summary>
/// 풀링 지원 플로팅 텍스트
/// </summary>
public class FloatingText : MonoBehaviour
{
    [SerializeField] private TextMeshProUGUI text;
    [SerializeField] private float floatSpeed = 1f;
    [SerializeField] private float fadeDuration = 0.8f;

    private System.Action<FloatingText> onComplete;

    public void Initialize(System.Action<FloatingText> returnToPool)
    {
        onComplete = returnToPool;
    }

    public void Show(string content, Vector3 worldPosition)
    {
        text.text = content;
        text.color = Color.white;
        transform.position = worldPosition;
        StopAllCoroutines();
        StartCoroutine(AnimateAndHide());
    }

    private IEnumerator AnimateAndHide()
    {
        float elapsed = 0f;
        Vector3 startPos = transform.position;
        Color startColor = text.color;

        while (elapsed < fadeDuration)
        {
            float t = elapsed / fadeDuration;
            transform.position = startPos + Vector3.up * floatSpeed * t;
            text.color = new Color(startColor.r, startColor.g, startColor.b, 1 - t);
            elapsed += Time.deltaTime;
            yield return null;
        }

        onComplete?.Invoke(this);
    }
}
```

### 2. FloatingTextSpawner.cs

**파일:** `Assets/02.Scripts/Effects/FloatingTextSpawner.cs`

```csharp
using UnityEngine;

/// <summary>
/// 플로팅 텍스트 풀링 및 스폰 관리
/// </summary>
public class FloatingTextSpawner : MonoBehaviour
{
    [SerializeField] private FloatingText prefab;
    [SerializeField] private int poolSize = 20;
    [SerializeField] private Vector3 spawnOffset = new Vector3(0, 2f, 0);

    private ObjectPool<FloatingText> pool;
    private Transform treeTransform;

    private void Awake()
    {
        pool = new ObjectPool<FloatingText>(prefab, transform, poolSize);
    }

    private void Start()
    {
        treeTransform = GameObject.FindWithTag("Tree")?.transform;
        GameEvents.Instance.OnWoodAdded += SpawnText;
    }

    private void OnDestroy()
    {
        if (GameEvents.Instance != null)
        {
            GameEvents.Instance.OnWoodAdded -= SpawnText;
        }
    }

    private void SpawnText(long amount)
    {
        if (treeTransform == null) return;

        var text = pool.Get();
        text.Initialize(ReturnToPool);

        // 약간의 랜덤 오프셋
        Vector3 randomOffset = new Vector3(
            Random.Range(-0.5f, 0.5f),
            Random.Range(-0.2f, 0.2f),
            0
        );

        text.Show($"+{amount}", treeTransform.position + spawnOffset + randomOffset);
    }

    private void ReturnToPool(FloatingText text)
    {
        pool.Return(text);
    }
}
```

### 3. Firewood.cs

**파일:** `Assets/02.Scripts/Effects/Firewood.cs`

장작 프리팹에 붙는 컴포넌트. Rigidbody 기반 물리 적용 후 일정 시간 뒤 풀로 반환.

### 4. FirewoodSpawner.cs

**파일:** `Assets/02.Scripts/Effects/FirewoodSpawner.cs`

OnTreeHit 이벤트 시 장작 프리팹 3~5개를 랜덤 방향으로 스폰. ObjectPool로 풀링 관리.

## 프리팹 설정

### FloatingText 프리팹

1. **Canvas (World Space) 생성:**
   ```
   FloatingText (Canvas)
   └── Text (TextMeshProUGUI)
   ```

2. **Canvas 설정:**
   - Render Mode: World Space
   - Width: 200, Height: 50
   - Scale: 0.01, 0.01, 0.01

3. **Text 설정:**
   - Font Size: 36
   - Alignment: Center
   - Color: White with Outline
   - Outweight: 0.2

4. **FloatingText.cs 추가:**
   - text 필드에 Text 연결
   - floatSpeed: 1
   - fadeDuration: 0.8

5. **프리팹으로 저장:**
   - Assets/03.Prefabs/FloatingText.prefab

### Firewood 프리팹

1. **장작 프리팹 설정:**
   - 장작 모델에 Firewood.cs 추가
   - Rigidbody 컴포넌트 추가 (자동 생성됨)
   - Collider 추가 (선택적)
   - Scale 조정 (0.1~0.2 정도)

2. **프리팹으로 저장:**
   - Assets/03.Prefabs/Firewood.prefab

## 씬 설정

1. **FloatingTextSpawner 추가:**
   - Empty GameObject "FloatingTextSpawner" 생성
   - FloatingTextSpawner.cs 추가
   - _prefab 필드에 FloatingText.prefab 연결

2. **FirewoodSpawner 추가:**
   - Empty GameObject "FirewoodSpawner" 생성
   - FirewoodSpawner.cs 추가
   - _prefab 필드에 Firewood.prefab 연결

## Acceptance Criteria

- [x] FloatingText.cs 컴파일 성공
- [x] FloatingTextSpawner.cs 컴파일 성공
- [x] Firewood.cs 컴파일 성공
- [x] FirewoodSpawner.cs 컴파일 성공
- [ ] 클릭 시 "+1" 텍스트가 위로 떠오르며 사라짐
- [ ] 플로팅 텍스트가 풀링으로 재사용됨 (Hierarchy에서 확인)
- [ ] 클릭 시 장작 프리팹 3~5개 튀어나옴
- [ ] 장작이 풀링으로 재사용됨 (Hierarchy에서 확인)

## 테스트 방법

1. Play 모드 시작
2. 나무 클릭
3. "+1" 텍스트가 나무 위에서 떠오르는지 확인
4. 장작 프리팹 3~5개가 튀어나오는지 확인
5. 장작이 1.5초 후 사라지는지 확인
6. 10번 연속 클릭해도 성능 저하 없이 동작하는지 확인
7. Hierarchy에서 풀링이 정상 동작하는지 확인

## 다음 태스크

→ M1.7 통합 테스트 (M1.3, M1.5, M1.6 완료 후)

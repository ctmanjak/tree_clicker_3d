---
title: "M2.0 오디오 시스템"
type: feat
date: 2026-01-27
milestone: M2
task_id: M2.0
depends_on: [M1]
scripts: 4
---

# M2.0: 오디오 시스템

## 목표

게임의 청각적 피드백을 담당하는 오디오 시스템을 구현합니다.
SFX, BGM, 환경음을 통합 관리합니다.

## 의존성

- **M1**: 프로토타입 완료 필수

## 구현할 스크립트

### 1. AudioManager.cs

```
Assets/02.Scripts/Audio/AudioManager.cs
```

**역할:** 전역 오디오 관리자

**주요 기능:**
- ServiceLocator 등록
- SFX/BGM/환경음 볼륨 분리 관리
- 사운드 풀링 (동시 재생 처리)
- 페이드 인/아웃 지원

**인터페이스:**
```csharp
public class AudioManager : MonoBehaviour
{
    // 볼륨 설정
    public float MasterVolume { get; set; }
    public float SFXVolume { get; set; }
    public float BGMVolume { get; set; }

    // SFX 재생
    public void PlaySFX(string sfxId);
    public void PlaySFX(AudioClip clip);
    public void PlaySFXAtPosition(string sfxId, Vector3 position);

    // BGM 제어
    public void PlayBGM(string bgmId);
    public void StopBGM(float fadeTime = 0.5f);
    public void PauseBGM();
    public void ResumeBGM();

    // 환경음 제어
    public void SetAmbientVolume(float volume);
}
```

### 2. SFXConfig.cs (ScriptableObject)

```
Assets/02.Scripts/Audio/SFXConfig.cs
```

**역할:** SFX 데이터 정의

**구조:**
```csharp
[CreateAssetMenu(fileName = "SFXConfig", menuName = "Audio/SFX Config")]
public class SFXConfig : ScriptableObject
{
    [System.Serializable]
    public class SFXEntry
    {
        public string id;
        public AudioClip[] clips;  // 랜덤 재생용 배열
        [Range(0f, 1f)] public float volume = 1f;
        [Range(0.8f, 1.2f)] public float pitchVariation = 1f;
    }

    public SFXEntry[] entries;
}
```

**필요한 SFX 목록:**
| ID | 설명 | 클립 수 |
|----|------|---------|
| hit_wood_1~4 | 나무 타격음 | 4 |
| hit_critical | 크리티컬 타격 | 1 |
| upgrade_buy | 업그레이드 구매 | 1 |
| lumberjack_spawn | 벌목꾼 소환 | 1 |
| lumberjack_hit | 벌목꾼 타격 | 2 |
| ui_click | UI 클릭 | 1 |
| ui_open | 패널 열기 | 1 |
| ui_close | 패널 닫기 | 1 |

### 3. BGMController.cs

```
Assets/02.Scripts/Audio/BGMController.cs
```

**역할:** BGM 전용 컨트롤러

**주요 기능:**
- 루프 재생
- 크로스페이드 전환
- 게임 상태에 따른 BGM 변경 (추후)

### 4. AmbientSoundController.cs

```
Assets/02.Scripts/Audio/AmbientSoundController.cs
```

**역할:** 환경음 관리

**주요 기능:**
- 숲 환경음 루프
- 새소리, 바람소리 등
- 낮/밤 전환 시 변경 (추후)

## 기존 코드 수정

### TreeController.cs 수정

```csharp
// Hit() 메서드에서 사운드 재생
public void Hit(long damage, Vector3 hitPoint)
{
    // 기존 로직...

    // 사운드 재생 추가
    var audioManager = ServiceLocator.Get<AudioManager>();
    audioManager?.PlaySFX("hit_wood_" + Random.Range(1, 5));
}
```

### LumberjackController.cs 수정

```csharp
// Attack() 메서드에서 사운드 재생
private void Attack()
{
    // 기존 로직...

    // 벌목꾼 타격 사운드
    var audioManager = ServiceLocator.Get<AudioManager>();
    audioManager?.PlaySFX("lumberjack_hit");
}
```

### UpgradeButtonUI.cs 수정

```csharp
// 구매 시 사운드 재생
private void OnPurchaseClicked()
{
    // 기존 로직...

    // 구매 사운드
    var audioManager = ServiceLocator.Get<AudioManager>();
    audioManager?.PlaySFX("upgrade_buy");
}
```

## 체크리스트

### 구현

- [ ] AudioManager 싱글톤 구현
- [ ] ServiceLocator 등록
- [ ] SFXConfig ScriptableObject 생성
- [ ] SFX 풀링 구현
- [ ] BGM 루프 재생
- [ ] 환경음 루프 재생
- [ ] 볼륨 조절 기능

### 연동

- [ ] 나무 타격 사운드 연동
- [ ] 벌목꾼 타격 사운드 연동
- [ ] 업그레이드 구매 사운드 연동
- [ ] UI 클릭 사운드 연동

### 테스트

- [ ] 동시 다발 사운드 재생 테스트
- [ ] 볼륨 조절 동작 확인
- [ ] BGM 페이드 인/아웃 테스트
- [ ] 메모리 누수 확인

## 에셋 요구사항

### 필수 (플레이스홀더 가능)
- 타격음 4종 (0.1~0.3초, WAV/OGG)
- BGM 1곡 (루프, 60초 이상)

### 권장
- 크리티컬 타격음 1종
- UI 사운드 3종
- 환경음 1종 (숲)

## 폴더 구조

```
Assets/
├── 02.Scripts/
│   └── Audio/
│       ├── AudioManager.cs
│       ├── SFXConfig.cs
│       ├── BGMController.cs
│       └── AmbientSoundController.cs
└── Audio/
    ├── SFX/
    │   ├── hit_wood_1.wav
    │   ├── hit_wood_2.wav
    │   └── ...
    ├── BGM/
    │   └── bgm_forest.ogg
    └── Ambient/
        └── ambient_forest.ogg
```

## 다음 단계

M2.0 완료 후:
→ M2.3 크리티컬 & 연출에서 크리티컬 사운드 연동

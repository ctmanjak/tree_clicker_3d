---
title: "M1.4 게임 필 - 플로팅 텍스트/파티클"
type: feat
date: 2026-01-26
milestone: M1
task_id: M1.4
depends_on: [M1.2]
scripts: 4
---

# M1.4: 게임 필 - 플로팅 텍스트/파티클

## 목표

클릭 시 획득량 표시 플로팅 텍스트와 나무 조각/잎사귀 파티클을 구현합니다.

## 의존성

- **M1.0**: ObjectPool 유틸리티
- **M1.2**: GameEvents.OnTreeHit, GameEvents.OnWoodAdded

## 작업 내용

### 1. FloatingText.cs

**파일:** `Assets/02.Scripts/Effects/FloatingText.cs`

```csharp
using System.Collections;
using UnityEngine;
using TMPro;

/// <summary>
/// 풀링 지원 플로팅 텍스트
/// </summary>
public class FloatingText : MonoBehaviour
{
    [SerializeField] private TextMeshProUGUI text;
    [SerializeField] private float floatSpeed = 1f;
    [SerializeField] private float fadeDuration = 0.8f;

    private System.Action<FloatingText> onComplete;

    public void Initialize(System.Action<FloatingText> returnToPool)
    {
        onComplete = returnToPool;
    }

    public void Show(string content, Vector3 worldPosition)
    {
        text.text = content;
        text.color = Color.white;
        transform.position = worldPosition;
        StopAllCoroutines();
        StartCoroutine(AnimateAndHide());
    }

    private IEnumerator AnimateAndHide()
    {
        float elapsed = 0f;
        Vector3 startPos = transform.position;
        Color startColor = text.color;

        while (elapsed < fadeDuration)
        {
            float t = elapsed / fadeDuration;
            transform.position = startPos + Vector3.up * floatSpeed * t;
            text.color = new Color(startColor.r, startColor.g, startColor.b, 1 - t);
            elapsed += Time.deltaTime;
            yield return null;
        }

        onComplete?.Invoke(this);
    }
}
```

### 2. FloatingTextSpawner.cs

**파일:** `Assets/02.Scripts/Effects/FloatingTextSpawner.cs`

```csharp
using UnityEngine;

/// <summary>
/// 플로팅 텍스트 풀링 및 스폰 관리
/// </summary>
public class FloatingTextSpawner : MonoBehaviour
{
    [SerializeField] private FloatingText prefab;
    [SerializeField] private int poolSize = 20;
    [SerializeField] private Vector3 spawnOffset = new Vector3(0, 2f, 0);

    private ObjectPool<FloatingText> pool;
    private Transform treeTransform;

    private void Awake()
    {
        pool = new ObjectPool<FloatingText>(prefab, transform, poolSize);
    }

    private void Start()
    {
        treeTransform = GameObject.FindWithTag("Tree")?.transform;
        GameEvents.Instance.OnWoodAdded += SpawnText;
    }

    private void OnDestroy()
    {
        if (GameEvents.Instance != null)
        {
            GameEvents.Instance.OnWoodAdded -= SpawnText;
        }
    }

    private void SpawnText(long amount)
    {
        if (treeTransform == null) return;

        var text = pool.Get();
        text.Initialize(ReturnToPool);

        // 약간의 랜덤 오프셋
        Vector3 randomOffset = new Vector3(
            Random.Range(-0.5f, 0.5f),
            Random.Range(-0.2f, 0.2f),
            0
        );

        text.Show($"+{amount}", treeTransform.position + spawnOffset + randomOffset);
    }

    private void ReturnToPool(FloatingText text)
    {
        pool.Return(text);
    }
}
```

### 3. HitParticleSpawner.cs

**파일:** `Assets/02.Scripts/Effects/HitParticleSpawner.cs`

```csharp
using UnityEngine;

/// <summary>
/// 타격 파티클 스폰
/// GameEvents 구독하여 이벤트 기반 동작
/// </summary>
public class HitParticleSpawner : MonoBehaviour
{
    [SerializeField] private ParticleSystem woodChipParticle;
    [SerializeField] private ParticleSystem leafParticle;

    private void Start()
    {
        GameEvents.Instance.OnTreeHit += SpawnParticles;
    }

    private void OnDestroy()
    {
        if (GameEvents.Instance != null)
        {
            GameEvents.Instance.OnTreeHit -= SpawnParticles;
        }
    }

    private void SpawnParticles()
    {
        woodChipParticle?.Play();
        leafParticle?.Play();
    }
}
```

## 프리팹 설정

### FloatingText 프리팹

1. **Canvas (World Space) 생성:**
   ```
   FloatingText (Canvas)
   └── Text (TextMeshProUGUI)
   ```

2. **Canvas 설정:**
   - Render Mode: World Space
   - Width: 200, Height: 50
   - Scale: 0.01, 0.01, 0.01

3. **Text 설정:**
   - Font Size: 36
   - Alignment: Center
   - Color: White with Outline
   - Outweight: 0.2

4. **FloatingText.cs 추가:**
   - text 필드에 Text 연결
   - floatSpeed: 1
   - fadeDuration: 0.8

5. **프리팹으로 저장:**
   - Assets/03.Prefabs/FloatingText.prefab

### 파티클 시스템

1. **나무 조각 파티클 (WoodChips):**
   - Duration: 0.3
   - Looping: false
   - Start Speed: 3-5
   - Start Size: 0.1-0.2
   - Start Color: Brown
   - Emission > Bursts: 5개
   - Shape: Sphere
   - Gravity Modifier: 1

2. **잎사귀 파티클 (Leaves):**
   - Duration: 0.5
   - Looping: false
   - Start Speed: 2-3
   - Start Size: 0.2-0.3
   - Start Color: Green
   - Emission > Bursts: 3개
   - Shape: Sphere
   - Gravity Modifier: 0.5

## 씬 설정

1. **FloatingTextSpawner 추가:**
   - Empty GameObject "FloatingTextSpawner" 생성
   - FloatingTextSpawner.cs 추가
   - prefab 필드에 FloatingText.prefab 연결

2. **HitParticleSpawner 추가:**
   - 나무 오브젝트에 HitParticleSpawner.cs 추가
   - 또는 별도 오브젝트로 생성
   - woodChipParticle, leafParticle 연결

## Acceptance Criteria

- [ ] FloatingText.cs 컴파일 성공
- [ ] FloatingTextSpawner.cs 컴파일 성공
- [ ] HitParticleSpawner.cs 컴파일 성공
- [ ] 클릭 시 "+1" 텍스트가 위로 떠오르며 사라짐
- [ ] 플로팅 텍스트가 풀링으로 재사용됨 (Hierarchy에서 확인)
- [ ] 클릭 시 나무 조각 파티클 발생
- [ ] 클릭 시 잎사귀 파티클 발생

## 테스트 방법

1. Play 모드 시작
2. 나무 클릭
3. "+1" 텍스트가 나무 위에서 떠오르는지 확인
4. 나무 조각과 잎사귀 파티클이 발생하는지 확인
5. 10번 연속 클릭해도 성능 저하 없이 동작하는지 확인

## 다음 태스크

→ M1.7 통합 테스트 (M1.3, M1.5, M1.6 완료 후)
